<!DOCTYPE html><html lang="fr" class="no-js"><head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Notes techniques du Loup">
      
      
        <meta name="author" content="Gérard Leloup">
      
      
        <link rel="canonical" href="https://loup79.github.io/notes-du-loup/blog/open-vswitch---vboxdeb12/">
      
      
        <link rel="prev" href="../podman---vboxdeb12-12/">
      
      
        <link rel="next" href="../ssh--cl%C3%A9s-publique-et-priv%C3%A9e/">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>Open vSwitch - VBox/Deb12 - Documents du Loup</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.618322db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CConsolas:400,400i,700,700i&amp;display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Consolas"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"><script src="../../assets/javascripts/glightbox.min.js"></script><style id="glightbox-style">
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color); }
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color); }
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color); }
        </style></head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#memento-51-switch-virtuel-ovs" class="md-skip">
          Aller au contenu
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="En-tête">
    <a href="../.." title="Documents du Loup" class="md-header__button md-logo" aria-label="Documents du Loup" data-md-component="logo">
      
  <img src="../../logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Documents du Loup
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Open vSwitch - VBox/Deb12
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Rechercher" placeholder="Rechercher" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
      </label>
      <nav class="md-search__options" aria-label="Recherche">
        
        <button type="reset" class="md-search__icon md-icon" title="Effacer" aria-label="Effacer" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initialisation de la recherche
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/loup79/notes-du-loup" title="Aller au dépôt" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
  </div>
  <div class="md-source__repository">
    Dépot du Loup
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Onglets" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../.." class="md-tabs__link">
          
  
  
  Accueil

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  
  Réseau virtuel

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../informatique/" class="md-tabs__link">
          
  
  
  Divers informatique

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../mkdocs/" class="md-tabs__link">
          
  
  
  Notes MkDocs

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" hidden>
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Documents du Loup" class="md-nav__button md-logo" aria-label="Documents du Loup" data-md-component="logo">
      
  <img src="../../logo.png" alt="logo">

    </a>
    Documents du Loup
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/loup79/notes-du-loup" title="Aller au dépôt" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
  </div>
  <div class="md-source__repository">
    Dépot du Loup
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1">
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Accueil
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Accueil
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Administrez votre réseau virtuel !
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../page-prerequis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Prérequis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../page-elements-reseau-virtuel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Eléments du réseau virtuel
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../page-construction-reseau-virtuel-debian/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Construction du réseau
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../page-liste-des-mementos/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Liste des mémentos
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Réseau virtuel
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Réseau virtuel
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      <a href="../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Index de tous les articles
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2">
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Filtrage par catégorie
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Filtrage par catégorie
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../01-hyperviseur-virtualbox/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    01 Hyperviseur Virtualbox
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../02-serveur-lan-srvlan/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    02 Serveur LAN "srvlan"
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../03-serveur-wan-srvsec/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    03 Serveur WAN "srvsec"
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../04-serveur-dmz-srvdmz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    04 Serveur DMZ "srvdmz"
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../05-clients-lan-vm1-vm2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    05 Clients LAN "vm1 vm2"
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../06-ovs--conteneurs-lxc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    06 OvS + Conteneurs LXC
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../07-acc%C3%A8s-rdp--vnc--ssh/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    07 Accès RDP + VNC + SSH
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../08-dns--dhcp--ddns/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    08 DNS + DHCP + DDNS
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../09-lamp--https--cms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    09 LAMP + HTTPS + CMS
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../10-sftp-acc%C3%A8s-cms---ftps/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    10 SFTP accès CMS - FTPS
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../11-dns-split-et-proxy-inverse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    11 DNS split et Proxy inverse
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../12-serveur-de-courrier/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    12 Serveur de courrier
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../13-cockpit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    13 Cockpit
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3">
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Divers informatique
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Divers informatique
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../informatique/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Les derniers articles
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2">
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Catégorie du site :
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Catégorie du site :
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../informatique/alpine/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Alpine
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../informatique/centreon/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Centreon
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../informatique/debian/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Debian
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../informatique/eve-ng/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    EVE-NG
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../informatique/intelligence-artificielle/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Intelligence artificielle
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../informatique/nextcloud/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Nextcloud
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../informatique/proxmox/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Proxmox
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../informatique/synology/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Synology
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../informatique/windows/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Windows
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4">
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Notes MkDocs
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Notes MkDocs
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mkdocs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Outil de documentation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mkdocs/bases-mkdocs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MkDocs - Bases
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mkdocs/debian-mkdocs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MkDocs - Site Web sur Debian
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mkdocs/vscodeserver-mkdocs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MkDocs - VS Code Server
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mkdocs/github-mkdocs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MkDocs - Site Web sur GitHub
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
                
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table des matières">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table des matières
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#memento-51-switch-virtuel-ovs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Mémento 5.1 - Switch virtuel OvS
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Mémento 5.1 - Switch virtuel OvS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#construction-de-la-vm-ovs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Construction de la VM ovs
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Construction de la VM ovs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#-creation-et-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        - Création et configuration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#-installation-de-debian-12" class="md-nav__link">
    <span class="md-ellipsis">
      
        - Installation de Debian 12
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#installation-configuration-dovs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Installation-configuration d'OvS
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Installation-configuration d'OvS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#-installation" class="md-nav__link">
    <span class="md-ellipsis">
      
        - Installation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        - Configuration
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integration-de-la-vm-ovs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Intégration de la VM ovs
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Intégration de la VM ovs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#-configuration-reseau-vbox" class="md-nav__link">
    <span class="md-ellipsis">
      
        - Configuration réseau VBox
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#-configuration-reseau-debian" class="md-nav__link">
    <span class="md-ellipsis">
      
        - Configuration réseau Debian
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#titre-4" class="md-nav__link">
    <span class="md-ellipsis">
      
        Raccordement vm1-2 sur OvS
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Raccordement vm1-2 sur OvS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#-creation-des-bridges-ports" class="md-nav__link">
    <span class="md-ellipsis">
      
        - Création des bridges-ports
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#-parametrage-reseau-debian" class="md-nav__link">
    <span class="md-ellipsis">
      
        - Paramétrage réseau Debian
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#-parametrage-reseau-vbox" class="md-nav__link">
    <span class="md-ellipsis">
      
        - Paramétrage réseau VBox
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#raccordement-vm1-2-sur-br0" class="md-nav__link">
    <span class="md-ellipsis">
      
        Raccordement vm1-2 sur br0
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-du-fonctionnement-dovs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Test du fonctionnement d'OvS
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
  <div class="md-content md-content--post" data-md-component="content">
    <div class="md-sidebar md-sidebar--post" data-md-component="sidebar" data-md-type="navigation">
      <div class="md-sidebar__scrollwrap">
        <div class="md-sidebar__inner md-post">
          <nav class="md-nav md-nav--primary">
            <div class="md-post__back">
              <div class="md-nav__title md-nav__container">
                <a href="../" class="md-nav__link">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
                  <span class="md-ellipsis">
                    Retourner à l'index
                  </span>
                </a>
              </div>
            </div>
            
              <div class="md-post__authors md-typeset">
                
                  <div class="md-profile md-post__profile">
                    <span class="md-author md-author--long">
                      <img src="https://loup79.github.io/notes-du-loup/blog/logo_bis.png" alt="Loup79">
                    </span>
                    <span class="md-profile__description">
                      <strong>
                        
                          Loup79
                        
                      </strong>
                      <br>
                      Réseau virtuel
                    </span>
                  </div>
                
              </div>
            
            <ul class="md-post__meta md-nav__list">
              <li class="md-nav__item md-nav__item--section">
                <div class="md-post__title">
                  <span class="md-ellipsis">
                    Metadonnées
                  </span>
                </div>
                <nav class="md-nav">
                  <ul class="md-nav__list">
                    <li class="md-nav__item">
                      <div class="md-nav__link">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 19H5V8h14m-3-7v2H8V1H6v2H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2h-1V1m-1 11h-5v5h5z"></path></svg>
                        <time datetime="2023-11-03 00:00:00+00:00" class="md-ellipsis">03/11/2023</time>
                      </div>
                    </li>
                    
                    
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 3v15h3V3zm3 2 4 13 3-1-4-13zM5 5v13h3V5zM3 19v2h18v-2z"></path></svg>
                          <span class="md-ellipsis">
                            dans
                            
                              <a href="../06-ovs--conteneurs-lxc/">06 OvS + Conteneurs LXC</a></span>
                        </div>
                      </li>
                    
                    
                      
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8m0-18a10 10 0 0 1 10 10 10 10 0 0 1-10 10C6.47 22 2 17.5 2 12A10 10 0 0 1 12 2m.5 5v5.25l4.5 2.67-.75 1.23L11 13V7z"></path></svg>
                          <span class="md-ellipsis">
                            
                              13 min de lecture
                            
                          </span>
                        </div>
                      </li>
                    
                  </ul>
                </nav>
              </li>
            </ul>
            
          </nav>
          
        </div>
      </div>
    </div>
    <article class="md-content__inner md-typeset">
      
        
  



  
  


  <h1>Open vSwitch - VBox/Deb12</h1>

<figure>
<p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="../images/2023/10/openvswitch_3.webp" data-title="Image Pixabay - Switch informatique de Bru-nO" data-desc-position="bottom"><img alt="Image Pixabay - Switch informatique de Bru-nO" src="../images/2023/10/openvswitch_3.webp" width="430"></a></p>
</figure>
<h2 id="memento-51-switch-virtuel-ovs">Mémento 5.1 - Switch virtuel OvS</h2>
<p>Open vSwitch <em>(OvS)</em> se comportera comme un véritable switch physique en proposant la gestion des adresses MAC tel un switch L2 ainsi que celle des adresses IP pour le routage des paquets IP tel un switch L3.</p>
<p>Le switch virtuel sera, contrairement à une architecture standard, installé sur une VM et non sur le PC hôte de l'hyperviseur VirtualBox.</p>
<p>Le raccordement externe des clients LAN Debian sur le switch se fera à l'aide de ports patch.</p>
<!-- more -->

<p>Le moyen d'approcher l'architecture standard sera de créer un conteneur à l'intérieur de la VM et de connecter celui-ci sur OVS à l'aide d'une interface réseau virtuelle Veth <em>(Mémento suivant)</em>.  </p>
<p>La gestion possible de VLAN ne sera pas traitée ici.</p>
<h3 id="construction-de-la-vm-ovs">Construction de la VM ovs</h3>
<p>L'utilisation de VirtualBox est considérée acquise.  </p>
<p>A défaut, référez-vous aux mémentos suivants :<br>
<a href="../virtualbox---installation/" target="_blank">VirtualBox - Installation</a><br>
<a href="../acc%C3%A8s-r%C3%A9seau-par-pont/" target="_blank">VirtualBox - Mode d’accès réseau par pont</a></p>
<h4 id="-creation-et-configuration"><em>- Création et configuration</em></h4>
<p>Le PC hôte doit être un PC&nbsp;64 bits, courant de nos jours.  </p>
<p>Téléchargez l'ISO debian-12.x.y-amd64-netinst.iso :<br>
<a href="https://cdimage.debian.org/debian-cd/current/amd64/iso-cd/" target="_blank">https://cdimage.debian.org/.../current/amd64/iso-cd/</a>  </p>
<p>- Démarrez ensuite l'application VirtualBox 7.x, puis :<br>
- - Menu de VirtualBox &gt; Machine &gt; Nouvelle...<br>
-&gt; Nom : ovs<br>
-&gt; Folder : Sélectionnez le dossier de stockage des VM<br>
-&gt; ISO Image : Sélectionnez l'ISO téléchargée ci-dessus<br>
-&gt; Type : Linux<br>
-&gt; Version : Debian (64-bit)<br>
-&gt; Cochez Skip Unattended Installation <em>(important)</em><br>
-&gt; Bouton Suivant  </p>
<p>-&gt; Mémoire vive : 1024 MB<br>
-&gt; Processors : 2 CPU si possible<br>
-&gt; Bouton Suivant</p>
<p>-&gt; Create a Virtual Hard Disk Now : Ajustez à 12 Go<br>
-&gt; Bouton Suivant</p>
<p>-&gt; Vérifiez le Récapitulatif<br>
-&gt; Bouton Finish</p>
<p>La VM s'affiche dans le panneau gauche de VirtualBox.  </p>
<p>- Sélectionnez maintenant la nouvelle VM, puis :<br>
- - Menu de VirtualBox &gt; Machine &gt; Configuration...<br>
- - - Onglet Général<br>
-&gt; Avancé &gt; Presse-papier partagé &gt; Bidirectionnel</p>
<p>- - - Onglet Système<br>
-&gt; Carte mère &gt; Ordre d'amorçage &gt; Décochez Disquette<br>
-&gt; Processeur &gt; Cochez Activer PAE/NX</p>
<p>-&gt; OK  </p>
<p>Les autres paramètres peuvent rester inchangés.</p>
<h4 id="-installation-de-debian-12"><em>- Installation de Debian 12</em></h4>
<p>Conseil pratique avant de démarrer la nouvelle VM :<br>
Si le curseur de la souris disparait lors d'un clic dans la fenêtre de la VM, celui-ci peut être récupéré par le PC hôte à l'aide de la touche CTRL située à droite de la barre d'espace du clavier.  </p>
<p>- - Menu de VirtualBox &gt; Machine &gt; Démarrer<br>
-&gt; Démarrage normal <em>(La VM s'exécute)</em></p>
<p>Sélectionnez Graphical Install et appliquez ce qui suit :<br>
- Language &gt; Français<br>
- Pays (territoire ou région) &gt; France<br>
- Disposition de clavier à utiliser &gt; Français<br>
- Nom de machine &gt; ovs<br>
- Domaine &gt; Laissez le champ vide<br>
- MDP du super utilisateur root &gt; Votre MDP root<br>
- Confirmation du MDP &gt; Votre MDP root<br>
- Nom complet du nouvel utilisateur &gt; Ex: switch<br>
- Identifiant pour le compte utilisateur &gt; switch<br>
- MDP pour le nouvel utilisateur &gt; Votre MDP switch<br>
- Confirmation du MDP &gt; Votre MDP switch<br>
- Méthode de partitionnement &gt; Assisté - utili... entier<br>
- Disque à partitionner &gt; Celui proposé de 12 Go<br>
- Schéma de partitionnement &gt; Tout ... seule partition<br>
- Table des partitions &gt; Terminer le partitionnement ...<br>
- Faut-il appliquer les changements … disques ? &gt; Oui  </p>
<p>L'installation de base commence :<br>
- Faut-il analyser d'autres supports ... ? &gt; Non<br>
- Pays du miroir de l'archive Debian &gt; France<br>
- Miroir de l'archive Debian &gt; deb.debian.org<br>
- Mandataire HTTP (lais...) &gt; Laissez vide  </p>
<p>L'installation continue :<br>
- Souhaitez-vous participer à l'étude statistique... &gt; Non<br>
- Logiciels à installer<br>
-&gt; Décochez environnement de bureau Debian<br>
-&gt; Décochez ... GNOME<br>
-&gt; Conservez utilitaires usuels du système  </p>
<p>L'installation se termine :<br>
- Installer ... de démarrage GRUB sur le secteur ... &gt; Oui<br>
- Périphérique ... programme de démarrage &gt; /dev/sda<br>
- Installation terminée &gt; Continuer <em>(sans retrait du CD)</em>  </p>
<p>Le système reboot et une fenêtre de connexion s'ouvre :<br>
-&gt; ovs login : Entrez switch<br>
-&gt; Password : Entrez Votre MDP switch<br>
Si tout est OK, affichage du prompt switch@ovs:~$</p>
<figure>
<p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="../images/2023/10/ovs-deb12-premier-demarrage.webp" data-title="Capture - Open vSwitch : Premier démarrage de la VM ovs" data-desc-position="bottom"><img alt="Capture - Open vSwitch : Premier démarrage de la VM ovs" src="../images/2023/10/ovs-deb12-premier-demarrage.webp"></a>
  </p>
<figcaption>Open vSwitch : Premier démarrage de la VM ovs</figcaption>
</figure>
<p>Donnez à présent les droits d'administrateur root à l'utilisateur switch :</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="o">[</span>switch@ovs:~$<span class="o">]</span><span class="w"> </span>su<span class="w"> </span>root
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>Mot<span class="w"> </span>de<span class="w"> </span>passe<span class="w"> </span>:<span class="w"> </span>Votre<span class="w"> </span>MDP<span class="w"> </span>root
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="o">[</span>root@ovs:~#<span class="o">]</span><span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>sudo
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="o">[</span>root@ovs:~#<span class="o">]</span><span class="w"> </span>sudo<span class="w"> </span>usermod<span class="w"> </span>-aG<span class="w"> </span>sudo<span class="w"> </span>switch
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="o">[</span>root@ovs:~#<span class="o">]</span><span class="w"> </span>sudo<span class="w"> </span>reboot
</span></code></pre></div>
<p>et reconnectez-vous en tant qu'utilisateur switch.  </p>
<p>Pour info, la VM peut être arrêtée de 2 façons :</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="o">[</span>switch@ovs:~$<span class="o">]</span><span class="w"> </span>sudo<span class="w"> </span>poweroff<span class="w">  </span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="o">[</span>switch@ovs:~$<span class="o">]</span><span class="w"> </span>sudo<span class="w"> </span>shutdown<span class="w"> </span>-h<span class="w"> </span>now
</span></code></pre></div>
<h3 id="installation-configuration-dovs">Installation-configuration d'OvS</h3>
<p>Au préalable, observez la configuration réseau active :</p>
<figure>
<p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="../images/2023/10/ovs-deb12-ip-address.webp" data-title="Capture - Open vSwitch : Cartes réseau de base lo et enp0s3" data-desc-position="bottom"><img alt="Capture - Open vSwitch : Cartes réseau de base lo et enp0s3" src="../images/2023/10/ovs-deb12-ip-address.webp"></a>
  </p>
<figcaption>Open vSwitch : Cartes réseau de base lo et enp0s3</figcaption>
</figure>
<h4 id="-installation"><em>- Installation</em></h4>
<p>Installez le paquet openvswitch-switch :</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="o">[</span>switch@ovs:~$<span class="o">]</span><span class="w"> </span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>openvswitch-switch
</span></code></pre></div>
<p>Les paquets concernant les dépendances manquantes sont ajoutés automatiquement.</p>
<p>Affichez maintenant la version d'Open vSwitch <em>(OvS)</em> :</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="o">[</span>switch@ovs:~$<span class="o">]</span><span class="w"> </span>sudo<span class="w"> </span>ovs-vsctl<span class="w"> </span>show
</span></code></pre></div>
<figure>
<p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="../images/2023/10/ovs-deb12-version-openvswitch.webp" data-title="Capture - Open vSwitch : Affichage de la version" data-desc-position="bottom"><img alt="Capture - Open vSwitch : Affichage de la version" src="../images/2023/10/ovs-deb12-version-openvswitch.webp"></a>
  </p>
<figcaption>Open vSwitch : Affichage de la version</figcaption>
</figure>
<p>ainsi que les informations du module openvswitch intégré dans le noyau linux :</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="o">[</span>switch@ovs:~$<span class="o">]</span><span class="w"> </span>sudo<span class="w"> </span>modinfo<span class="w"> </span>openvswitch
</span></code></pre></div>
<figure>
<p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="../images/2023/10/ovs-deb12-module-noyau-openvswitch.webp" data-title="Capture - Open vSwitch : Informations sur le module noyau openvswitch.ko" data-desc-position="bottom"><img alt="Capture - Open vSwitch : Informations sur le module noyau openvswitch.ko" src="../images/2023/10/ovs-deb12-module-noyau-openvswitch.webp"></a>
  </p>
<figcaption>Open vSwitch : Chemin du module openvswitch.ko</figcaption>
</figure>
<p>Contrôlez enfin le bon chargement du module :</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="o">[</span>switch@ovs:~$<span class="o">]</span><span class="w"> </span>lsmod<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>openvswitch
</span></code></pre></div>
<figure>
<p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="../images/2023/10/ovs-deb12-modules-lsmod.webp" data-title="Capture - Open vSwitch : Module openvswitch.ko chargé" data-desc-position="bottom"><img alt="Capture - Open vSwitch : Module openvswitch.ko chargé" src="../images/2023/10/ovs-deb12-modules-lsmod.webp"></a>
  </p>
<figcaption>Open vSwitch : Module openvswitch.ko chargé</figcaption>
</figure>
<p>- - Liste des <a href="../images/2023/10/openvswitch-composants.webp" target="_blank">principaux composants</a> OVS installés - -</p>
<p>- /usr/sbin/ovs-vswitchd :<br>
Le service de commutation <em>(compatible OpenFlow)</em>.  </p>
<p>- /usr/bin/ovs-appctl :<br>
Dialogue CLI <em>(Command Line Interface)</em> avec le service.  </p>
<p>- /usr/bin/ovs-vsctl :<br>
Configuration CLI du service via le serveur de Bdd.  </p>
<p>- /usr/sbin/ovsdb-server :<br>
Le serveur de Bdd contenant la configuration du service.  </p>
<p>- /usr/bin/ovsdb-client :<br>
Dialogue CLI avec le serveur de Bdd <em>(backup, etc...)</em>.  </p>
<p>- /usr/bin/ovsdb-tool :<br>
Configuration CLI des fichiers de la Bdd <em>(création, etc...)</em>.  </p>
<p>- /usr/bin/ovs-dpctl :<br>
Configuration CLI des datapaths du noyau d'OVS.  </p>
<p>- /usr/bin/ovs-ofctl :<br>
Configuration CLI de la partie OpenFlow d'OVS.  </p>
<p>La Bdd conf.db se situe dans /etc/openvswitch/.<br>
Les logs se situent dans /var/log/openvswitch/.</p>
<p>Contrôlez l'activation du service openvswitch-switch :</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="o">[</span>switch@ovs:~$<span class="o">]</span><span class="w"> </span>sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>openvswitch-switch
</span></code></pre></div>
<figure>
<p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="../images/2023/10/ovs-deb12-service-openvswitch-switch.webp" data-title="Capture - Open vSwitch : Service openvswitch-switch activé" data-desc-position="bottom"><img alt="Capture - Open vSwitch : Service openvswitch-switch activé" src="../images/2023/10/ovs-deb12-service-openvswitch-switch.webp"></a>
  </p>
<figcaption>Open vSwitch : Service openvswitch-switch activé</figcaption>
</figure>
<p>ainsi que celle des 2 services suivants :</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="o">[</span>switch@ovs:~$<span class="o">]</span><span class="w"> </span>sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>ovsdb-server
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="o">[</span>switch@ovs:~$<span class="o">]</span><span class="w"> </span>sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>ovs-vswitchd
</span></code></pre></div>
<h4 id="-configuration"><em>- Configuration</em></h4>
<p>Commencez par créer un bridge <em>(switch)</em> de nom br0 :</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="o">[</span>switch@ovs:~$<span class="o">]</span><span class="w"> </span>sudo<span class="w"> </span>ovs-vsctl<span class="w"> </span>add-br<span class="w"> </span>br0<span class="w">   </span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="o">[</span>switch@ovs:~$<span class="o">]</span><span class="w"> </span>sudo<span class="w"> </span>ovs-vsctl<span class="w"> </span>show
</span></code></pre></div>
<figure>
<p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="../images/2023/10/ovs-deb12-creation-br0.webp" data-title="Capture - Open vSwitch : Vue création bridge br0" data-desc-position="bottom"><img alt="Capture - Open vSwitch : Vue création bridge br0" src="../images/2023/10/ovs-deb12-creation-br0.webp"></a>
  </p>
<figcaption>Open vSwitch : Vue création bridge br0</figcaption>
</figure>
<p>Un port et une interface virtuels de même nom ont été associés au bridge.</p>
<p>Utilisez la Cde del-br pour détruire un bridge existant.</p>
<p>Observez les infos détaillées du bridge br0 comme suit :</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="o">[</span>switch@ovs:~$<span class="o">]</span><span class="w"> </span>sudo<span class="w"> </span>ovs-vsctl<span class="w"> </span>list<span class="w"> </span>br<span class="w"> </span>br0
</span></code></pre></div>
<p>et la création de l'interface br0 avec la Cde ip address :</p>
<figure>
<p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="../images/2023/10/ovs-deb12-interface-reseau-br0.webp" data-title="Capture - Open vSwitch : Vue interface br0" data-desc-position="bottom"><img alt="Capture - Open vSwitch : Vue interface br0" src="../images/2023/10/ovs-deb12-interface-reseau-br0.webp"></a>
  </p>
<figcaption>Open vSwitch : Vue interface br0</figcaption>
</figure>
<p>Testez l'interface enp0s3 avec un ping vers yahoo.fr, celui-ci doit recevoir une réponse positive.</p>
<p>Rattachez à présent l'interface enp0s3 au bridge br0 :</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="o">[</span>switch@ovs:~$<span class="o">]</span><span class="w"> </span>sudo<span class="w"> </span>ovs-vsctl<span class="w"> </span>add-port<span class="w"> </span>br0<span class="w"> </span>enp0s3<span class="w">  </span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="o">[</span>switch@ovs:~$<span class="o">]</span><span class="w"> </span>sudo<span class="w"> </span>ovs-vsctl<span class="w"> </span>show
</span></code></pre></div>
<figure>
<p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="../images/2023/10/ovs-deb12-affectation-port-enp0s3.webp" data-title="Capture - Open vSwitch : Vue affectation enp0s3 sur br0" data-desc-position="bottom"><img alt="Capture - Open vSwitch : Vue affectation enp0s3 sur br0" src="../images/2023/10/ovs-deb12-affectation-port-enp0s3.webp"></a>
  </p>
<figcaption>Open vSwitch : Vue affectation enp0s3 sur br0</figcaption>
</figure>
<p>Le port virtuel enp0s3 et l'interface virtuelle enp0s3 ne font qu'un.</p>
<p>Utilisez la Cde del-port pour détruire un port existant.</p>
<p>Observez de nouveau le retour de la Cde ip address :</p>
<figure>
<p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="../images/2023/10/ovs-deb12-affectation-interface-enp0s3.webp" data-title="Capture - Open vSwitch : Mêmes adresses MAC enp0s3/br0" data-desc-position="bottom"><img alt="Capture - Open vSwitch : Mêmes adresses MAC enp0s3/br0" src="../images/2023/10/ovs-deb12-affectation-interface-enp0s3.webp"></a>
  </p>
<figcaption>Open vSwitch : Mêmes adresses MAC enp0s3/br0</figcaption>
</figure>
<p>La carte virtuelle br0 possède à présent la même adresse MAC que la carte virtuelle enp0s3.</p>
<h3 id="integration-de-la-vm-ovs">Intégration de la VM ovs</h3>
<h4 id="-configuration-reseau-vbox"><em>- Configuration réseau VBox</em></h4>
<p>Stoppez la VM :</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="o">[</span>switch@ovs:~$<span class="o">]</span><span class="w"> </span>sudo<span class="w"> </span>poweroff
</span></code></pre></div>
<p>Sélectionnez ensuite celle-ci dans VirtualBox, puis :<br>
- - Menu de VirtualBox &gt; Machine &gt; Configuration...<br>
- - - Onglet Réseau<br>
-&gt; Adapter 1<br>
-&gt; Mode d'accès réseau &gt; Réseau interne<br>
-&gt; Name &gt; Sélectionnez switch_interne<br>
-&gt; Avancé &gt; Mode Promiscuité<br>
-&gt; Sélectionnez Allow VMs</p>
<p>-&gt; Adapter 2<br>
-&gt; Cochez Activer l'interface réseau<br>
-&gt; Mode d'accès réseau &gt; Réseau interne<br>
-&gt; Name &gt; Entrez liaison_vm1<br>
-&gt; Avancé &gt; Mode Promiscuité<br>
-&gt; Sélectionnez Allow VMs</p>
<p>-&gt; Adapter 3<br>
-&gt; Cochez Activer l'interface réseau<br>
-&gt; Mode d'accès réseau &gt; Réseau interne<br>
-&gt; Name &gt; Entrez liaison_vm2<br>
-&gt; Avancé &gt; Mode Promiscuité<br>
-&gt; Sélectionnez Allow VMs</p>
<p>-&gt; OK</p>
<p>Redémarrez la VM.</p>
<p>Il est impossible, OVS n'étant pas installé sur le PC hôte de VirtualBox, d'attribuer aux interfaces 2 et 3 un mode d'accès réseau généralement utilisé avec OVS soit un mode de type Accès par pont au travers d'une interface réseau virtuelle TAP <em>( <a href="#titre-4">Voir le § 4</a> )</em>.</p>
<p>C'est donc le type Réseau interne qui sera utilisé.  </p>
<p>Le mode promiscuité Allow VMs permettra à la VM ovs de travailler tel un switch et traiter ainsi tout le trafic réseau à destination et en provenance d'autres VM.  </p>
<p>Il est nécessaire, dans une infrastructure virtualisée telle Open vSwitch installé sur une VM, d'appliquer le mode promiscuité à une interface réseau devant agir comme un pont <em>(bridge)</em>.</p>
<h4 id="-configuration-reseau-debian"><em>- Configuration réseau Debian</em></h4>
<p>Vous allez à présent configurer OVS au boot de la VM.</p>
<p>Editez pour cela le fichier réseau interfaces :</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="o">[</span>switch@ovs:~$<span class="o">]</span><span class="w"> </span>sudo<span class="w"> </span>nano<span class="w"> </span>/etc/network/interfaces
</span></code></pre></div>
<p>et modifiez le comme suit :</p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="gh"># This file describes the network interfaces availabl...</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="gh"># and how to activate them. For more information, see ...</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>source /etc/network/interfaces.d/*
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="gh"># The loopback network interface</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>auto lo
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>iface lo inet loopback
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a><span class="gh"># The primary network interface</span>
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a><span class="gh"># Mettre un # devant les 2 lignes ci-dessous</span>
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a><span class="gh">#allow-hotplug enp0s3</span>
</span><span id="__span-13-13"><a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a><span class="gh">#iface enp0s3 inet dhcp</span>
</span><span id="__span-13-14"><a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a>
</span><span id="__span-13-15"><a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a><span class="gu">## Configuration Open vSwitch</span>
</span><span id="__span-13-16"><a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a><span class="gh"># Activation de l'interface br0</span>
</span><span id="__span-13-17"><a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a>auto br0
</span><span id="__span-13-18"><a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a>allow-ovs br0
</span><span id="__span-13-19"><a id="__codelineno-13-19" name="__codelineno-13-19" href="#__codelineno-13-19"></a>
</span><span id="__span-13-20"><a id="__codelineno-13-20" name="__codelineno-13-20" href="#__codelineno-13-20"></a><span class="gh"># Configuration IP de l'interface br0</span>
</span><span id="__span-13-21"><a id="__codelineno-13-21" name="__codelineno-13-21" href="#__codelineno-13-21"></a>iface br0 inet static
</span><span id="__span-13-22"><a id="__codelineno-13-22" name="__codelineno-13-22" href="#__codelineno-13-22"></a>address 192.168.3.15
</span><span id="__span-13-23"><a id="__codelineno-13-23" name="__codelineno-13-23" href="#__codelineno-13-23"></a>netmask 255.255.255.0
</span><span id="__span-13-24"><a id="__codelineno-13-24" name="__codelineno-13-24" href="#__codelineno-13-24"></a>gateway 192.168.3.1
</span><span id="__span-13-25"><a id="__codelineno-13-25" name="__codelineno-13-25" href="#__codelineno-13-25"></a>ovs_type OVSBridge
</span><span id="__span-13-26"><a id="__codelineno-13-26" name="__codelineno-13-26" href="#__codelineno-13-26"></a>ovs_ports enp0s3
</span><span id="__span-13-27"><a id="__codelineno-13-27" name="__codelineno-13-27" href="#__codelineno-13-27"></a>
</span><span id="__span-13-28"><a id="__codelineno-13-28" name="__codelineno-13-28" href="#__codelineno-13-28"></a><span class="gh"># Attachement du port/interface enp0s3 au bridge br0</span>
</span><span id="__span-13-29"><a id="__codelineno-13-29" name="__codelineno-13-29" href="#__codelineno-13-29"></a>allow-br0 enp0s3
</span><span id="__span-13-30"><a id="__codelineno-13-30" name="__codelineno-13-30" href="#__codelineno-13-30"></a>iface enp0s3 inet manual
</span><span id="__span-13-31"><a id="__codelineno-13-31" name="__codelineno-13-31" href="#__codelineno-13-31"></a>ovs_bridge br0
</span><span id="__span-13-32"><a id="__codelineno-13-32" name="__codelineno-13-32" href="#__codelineno-13-32"></a>ovs_type OVSPort
</span></code></pre></div>
<p>Redémarrez ensuite le service networking.service :</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="o">[</span>switch@ovs:~$<span class="o">]</span><span class="w"> </span>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>networking
</span></code></pre></div>
<p>et contrôlez le résultat avec la Cde ip address :</p>
<figure>
<p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="../images/2023/10/ovs-deb12-adresse-ip-br0.webp" data-title="Capture - Open vSwitch : Vue adresse IP sur interface br0" data-desc-position="bottom"><img alt="Capture - Open vSwitch : Vue adresse IP sur interface br0" src="../images/2023/10/ovs-deb12-adresse-ip-br0.webp"></a>
  </p>
<figcaption>Open vSwitch : Vue adresse IP sur interface br0</figcaption>
</figure>
<p>Constat :<br>
- 2 nouvelles interfaces réseau enp0s8 et enp0s9<br>
- L'interface br0 a la même adresse MAC que enp0s3<br>
- L'interface br0 possède l'adresse IP 192.168.3.15<br>
- Le ping vers l'adresse lP 192.168.3.1 fonctionne</p>
<p>L'adresse IP 192.168.3.15 sera utilisée plus tard pour administrer Open vSwitch à distance.</p>
<p><strong>Attention :</strong>
Lors d'un reboot du système, il est souvent nécessaire de relancer <mark>manuellement</mark> le service networking pour qu'Open vSwitch refonctionne correctement (bug ?).</p>
<p>Vous allez donc créer un nouveau service chargé de relancer <mark>automatiquement</mark> celui-ci durant la phase de reboot, ceci avant l'ouverture de la session utilisateur.</p>
<p>Créez le service networking-restart.service :</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="o">[</span>switch@ovs:~$<span class="o">]</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>/etc/systemd/system/
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="o">[</span>switch@ovs:~$<span class="o">]</span><span class="w"> </span>sudo<span class="w"> </span>nano<span class="w"> </span>networking-restart.service
</span></code></pre></div>
<p>et entrez le contenu suivant :</p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>[Unit]
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>Description=Redémarrage du service networking
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>Before=graphical.target
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>After=network.target
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>[Service]
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>Type=oneshot
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>ExecStart=/bin/sleep 6
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a>ExecStart=/sbin/service networking restart
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a>RemainAfterExit=true
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a>
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a>[Install]
</span><span id="__span-16-13"><a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a>WantedBy=multi-user.target
</span></code></pre></div>
<p>La Cde sleep 6 fera que le service networking sera relancé 6 secondes après le boot.</p>
<p>Testez le nouveau service :</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="o">[</span>switch@ovs:~$<span class="o">]</span><span class="w"> </span>sudo<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>networking-restart
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="o">[</span>switch@ovs:~$<span class="o">]</span><span class="w"> </span>sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>networking-restart
</span></code></pre></div>
<p>Si le statut est OK, activez le service :</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="o">[</span>switch@ovs:~$<span class="o">]</span><span class="w"> </span>sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>networking-restart
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="o">[</span>switch@ovs:~$<span class="o">]</span><span class="w"> </span>sudo<span class="w"> </span>reboot
</span></code></pre></div>
<p>Vous ne devriez plus avoir besoin de redémarrer manuellement le service networking après un boot, le ping vers l'adresse lP 192.168.3.1 doit fonctionner.</p>
<h3 id="titre-4">Raccordement vm1-2 sur OvS</h3>
<p>Open vSwitch est généralement installé sur le PC hôte de l'hyperviseur. Un bridge tel br0 utilise alors les interfaces réseau physiques du PC hôte pour l'accès à Internet et des interfaces réseau virtuelles TAP de niveau L2 pour l'accès aux VM.</p>
<p>Dans le cas présent, Open vSwitch est installé sur une VM de VirtualBox.</p>
<p>Vous allez donc raccorder les 2 clients Debian sur les interfaces réseau enp0s8/9 de la VM ovs, interfaces qui seront rattachées à des bridges de nom br1/2.</p>
<p>Vous lierez les 3 bridges à l'aide de ports patch :</p>
<figure>
<p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="../images/2023/10/ovs-deb12-patch-bridges.webp" data-title="Capture - Open vSwitch : Bridges montés en cascade" data-desc-position="bottom"><img alt="Capture - Open vSwitch : Bridges montés en cascade" src="../images/2023/10/ovs-deb12-patch-bridges.webp"></a>
  </p>
<figcaption>Open vSwitch : Bridges montés en cascade</figcaption>
</figure>
<p>L'ensemble des bridges rattachés avec des ports patch (ports de brassage) peut être vu comme un seul pont.  </p>
<p>La création de VLAN et le routage de paquets IP entre ceux-ci restent possibles.</p>
<h4 id="-creation-des-bridges-ports"><em>- Création des bridges-ports</em></h4>
<p>Créez les bridges br1 et br2 :</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="o">[</span>switch@ovs:~$<span class="o">]</span><span class="w"> </span>sudo<span class="w"> </span>ovs-vsctl<span class="w"> </span>add-br<span class="w"> </span>br1<span class="w">  </span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="o">[</span>switch@ovs:~$<span class="o">]</span><span class="w"> </span>sudo<span class="w"> </span>ovs-vsctl<span class="w"> </span>add-br<span class="w"> </span>br2
</span></code></pre></div>
<p>Rattachez les interfaces enp0s8/9 aux bridges br1/2 :</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="o">[</span>switch@ovs:~$<span class="o">]</span><span class="w"> </span>sudo<span class="w"> </span>ovs-vsctl<span class="w"> </span>add-port<span class="w"> </span>br1<span class="w"> </span>enp0s8<span class="w">  </span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="o">[</span>switch@ovs:~$<span class="o">]</span><span class="w"> </span>sudo<span class="w"> </span>ovs-vsctl<span class="w"> </span>add-port<span class="w"> </span>br2<span class="w"> </span>enp0s9
</span></code></pre></div>
<p>Reliez maintenant br0 avec br1 :</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="o">[</span>switch@ovs:~$<span class="o">]</span><span class="w"> </span>sudo<span class="w"> </span>ovs-vsctl<span class="w"> </span>--<span class="w"> </span>add-port<span class="w"> </span>br0<span class="w"> </span>br0-patch0<span class="w"> </span><span class="se">\</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>--<span class="w"> </span><span class="nb">set</span><span class="w"> </span>interface<span class="w"> </span>br0-patch0<span class="w"> </span><span class="nv">type</span><span class="o">=</span>patch<span class="w"> </span>options:peer<span class="o">=</span>br1-patch0
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="o">[</span>switch@ovs:~$<span class="o">]</span><span class="w"> </span>sudo<span class="w"> </span>ovs-vsctl<span class="w"> </span>--<span class="w"> </span>add-port<span class="w"> </span>br1<span class="w"> </span>br1-patch0<span class="w"> </span><span class="se">\</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a>--<span class="w"> </span><span class="nb">set</span><span class="w"> </span>interface<span class="w"> </span>br1-patch0<span class="w"> </span><span class="nv">type</span><span class="o">=</span>patch<span class="w"> </span>options:peer<span class="o">=</span>br0-patch0<span class="w">&nbsp; </span>
</span></code></pre></div>
<p>Le caractère&nbsp;\&nbsp;indique d'écrire le tout sur une seule ligne.  </p>
<p>puis br1 avec br2 :</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="o">[</span>switch@ovs:~$<span class="o">]</span><span class="w"> </span>sudo<span class="w"> </span>ovs-vsctl<span class="w"> </span>--<span class="w"> </span>add-port<span class="w"> </span>br1<span class="w"> </span>br1-patch1<span class="w"> </span><span class="se">\</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>--<span class="w"> </span><span class="nb">set</span><span class="w"> </span>interface<span class="w"> </span>br1-patch1<span class="w"> </span><span class="nv">type</span><span class="o">=</span>patch<span class="w"> </span>options:peer<span class="o">=</span>br2-patch0<span class="w"> </span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="o">[</span>switch@ovs:~$<span class="o">]</span><span class="w"> </span>sudo<span class="w"> </span>ovs-vsctl<span class="w"> </span>--<span class="w"> </span>add-port<span class="w"> </span>br2<span class="w"> </span>br2-patch0<span class="w"> </span><span class="se">\</span>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a>--<span class="w"> </span><span class="nb">set</span><span class="w"> </span>interface<span class="w"> </span>br2-patch0<span class="w"> </span><span class="nv">type</span><span class="o">=</span>patch<span class="w"> </span>options:peer<span class="o">=</span>br1-patch1
</span></code></pre></div>
<p>Contrôlez la prise en compte de la configuration :</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="o">[</span>switch@ovs:~$<span class="o">]</span><span class="w"> </span>sudo<span class="w"> </span>ovs-vsctl<span class="w">  </span>show
</span></code></pre></div>
<figure>
<p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="../images/2023/10/ovs-deb12-controle-patch-bridges.webp" data-title="Capture - Open vSwitch : Contrôle configuration patch" data-desc-position="bottom"><img alt="Capture - Open vSwitch : Contrôle configuration patch" src="../images/2023/10/ovs-deb12-controle-patch-bridges.webp"></a>
  </p>
<figcaption>Open vSwitch : Contrôle configuration patch</figcaption>
</figure>
<h4 id="-parametrage-reseau-debian"><em>- Paramétrage réseau Debian</em></h4>
<p>Editez le fichier interfaces :</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="o">[</span>switch@ovs:~$<span class="o">]</span><span class="w"> </span>sudo<span class="w"> </span>nano<span class="w"> </span>/etc/network/interfaces
</span></code></pre></div>
<p>et modifiez le comme suit :</p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="gh"># This file describes the network interfaces availabl...</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="gh"># and how to activate them. For more information, see ...</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>source /etc/network/interfaces.d/*
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="gh"># The loopback network interface</span>
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a>auto lo
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a>iface lo inet loopback
</span><span id="__span-25-9"><a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a>
</span><span id="__span-25-10"><a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a><span class="gh"># The primary network interface</span>
</span><span id="__span-25-11"><a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a><span class="gh"># Mettre un # devant les 2 lignes ci-dessous</span>
</span><span id="__span-25-12"><a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a><span class="gh">#allow-hotplug enp0s3</span>
</span><span id="__span-25-13"><a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a><span class="gh">#iface enp0s3 inet dhcp</span>
</span><span id="__span-25-14"><a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a>
</span><span id="__span-25-15"><a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a><span class="gu">## Configuration Open vSwitch</span>
</span><span id="__span-25-16"><a id="__codelineno-25-16" name="__codelineno-25-16" href="#__codelineno-25-16"></a><span class="gh"># Configuration du bridge br0</span>
</span><span id="__span-25-17"><a id="__codelineno-25-17" name="__codelineno-25-17" href="#__codelineno-25-17"></a>auto br0
</span><span id="__span-25-18"><a id="__codelineno-25-18" name="__codelineno-25-18" href="#__codelineno-25-18"></a>allow-ovs br0
</span><span id="__span-25-19"><a id="__codelineno-25-19" name="__codelineno-25-19" href="#__codelineno-25-19"></a>
</span><span id="__span-25-20"><a id="__codelineno-25-20" name="__codelineno-25-20" href="#__codelineno-25-20"></a><span class="gh"># Configuration IP de l'interface br0</span>
</span><span id="__span-25-21"><a id="__codelineno-25-21" name="__codelineno-25-21" href="#__codelineno-25-21"></a>iface br0 inet static
</span><span id="__span-25-22"><a id="__codelineno-25-22" name="__codelineno-25-22" href="#__codelineno-25-22"></a>address 192.168.3.15
</span><span id="__span-25-23"><a id="__codelineno-25-23" name="__codelineno-25-23" href="#__codelineno-25-23"></a>netmask 255.255.255.0
</span><span id="__span-25-24"><a id="__codelineno-25-24" name="__codelineno-25-24" href="#__codelineno-25-24"></a>gateway 192.168.3.1
</span><span id="__span-25-25"><a id="__codelineno-25-25" name="__codelineno-25-25" href="#__codelineno-25-25"></a>ovs_type OVSBridge
</span><span id="__span-25-26"><a id="__codelineno-25-26" name="__codelineno-25-26" href="#__codelineno-25-26"></a>ovs_ports enp0s3 br0-patch0
</span><span id="__span-25-27"><a id="__codelineno-25-27" name="__codelineno-25-27" href="#__codelineno-25-27"></a>
</span><span id="__span-25-28"><a id="__codelineno-25-28" name="__codelineno-25-28" href="#__codelineno-25-28"></a><span class="gh"># Attachement du port/interface enp0s3 au bridge br0</span>
</span><span id="__span-25-29"><a id="__codelineno-25-29" name="__codelineno-25-29" href="#__codelineno-25-29"></a>allow-br0 enp0s3
</span><span id="__span-25-30"><a id="__codelineno-25-30" name="__codelineno-25-30" href="#__codelineno-25-30"></a>iface enp0s3 inet manual
</span><span id="__span-25-31"><a id="__codelineno-25-31" name="__codelineno-25-31" href="#__codelineno-25-31"></a>ovs_bridge br0
</span><span id="__span-25-32"><a id="__codelineno-25-32" name="__codelineno-25-32" href="#__codelineno-25-32"></a>ovs_type OVSPort
</span><span id="__span-25-33"><a id="__codelineno-25-33" name="__codelineno-25-33" href="#__codelineno-25-33"></a>
</span><span id="__span-25-34"><a id="__codelineno-25-34" name="__codelineno-25-34" href="#__codelineno-25-34"></a><span class="gh"># Liaison patch br0 vers br1</span>
</span><span id="__span-25-35"><a id="__codelineno-25-35" name="__codelineno-25-35" href="#__codelineno-25-35"></a>allow-br0 br0-patch0
</span><span id="__span-25-36"><a id="__codelineno-25-36" name="__codelineno-25-36" href="#__codelineno-25-36"></a>iface br0-patch0 inet manual
</span><span id="__span-25-37"><a id="__codelineno-25-37" name="__codelineno-25-37" href="#__codelineno-25-37"></a>ovs_bridge br0
</span><span id="__span-25-38"><a id="__codelineno-25-38" name="__codelineno-25-38" href="#__codelineno-25-38"></a>ovs_type OVSPatchPort
</span><span id="__span-25-39"><a id="__codelineno-25-39" name="__codelineno-25-39" href="#__codelineno-25-39"></a>ovs_patch_peer br1-patch0  
</span><span id="__span-25-40"><a id="__codelineno-25-40" name="__codelineno-25-40" href="#__codelineno-25-40"></a> &nbsp;
</span><span id="__span-25-41"><a id="__codelineno-25-41" name="__codelineno-25-41" href="#__codelineno-25-41"></a><span class="gh"># Configuration du bridge br1</span>
</span><span id="__span-25-42"><a id="__codelineno-25-42" name="__codelineno-25-42" href="#__codelineno-25-42"></a>auto br1
</span><span id="__span-25-43"><a id="__codelineno-25-43" name="__codelineno-25-43" href="#__codelineno-25-43"></a>allow-ovs br1
</span><span id="__span-25-44"><a id="__codelineno-25-44" name="__codelineno-25-44" href="#__codelineno-25-44"></a>iface br1 inet manual
</span><span id="__span-25-45"><a id="__codelineno-25-45" name="__codelineno-25-45" href="#__codelineno-25-45"></a>ovs_type OVSBridge
</span><span id="__span-25-46"><a id="__codelineno-25-46" name="__codelineno-25-46" href="#__codelineno-25-46"></a>ovs_ports enp0s8 br1-patch0 br1-patch1
</span><span id="__span-25-47"><a id="__codelineno-25-47" name="__codelineno-25-47" href="#__codelineno-25-47"></a> &nbsp;
</span><span id="__span-25-48"><a id="__codelineno-25-48" name="__codelineno-25-48" href="#__codelineno-25-48"></a>allow-br1 enp0s8
</span><span id="__span-25-49"><a id="__codelineno-25-49" name="__codelineno-25-49" href="#__codelineno-25-49"></a>iface enp0s8 inet manual
</span><span id="__span-25-50"><a id="__codelineno-25-50" name="__codelineno-25-50" href="#__codelineno-25-50"></a>ovs_bridge br1
</span><span id="__span-25-51"><a id="__codelineno-25-51" name="__codelineno-25-51" href="#__codelineno-25-51"></a>ovs_type OVSPort
</span><span id="__span-25-52"><a id="__codelineno-25-52" name="__codelineno-25-52" href="#__codelineno-25-52"></a>
</span><span id="__span-25-53"><a id="__codelineno-25-53" name="__codelineno-25-53" href="#__codelineno-25-53"></a><span class="gh"># Liaisons patch br1 vers br0 et br2 </span>
</span><span id="__span-25-54"><a id="__codelineno-25-54" name="__codelineno-25-54" href="#__codelineno-25-54"></a>allow-br1 br1-patch0
</span><span id="__span-25-55"><a id="__codelineno-25-55" name="__codelineno-25-55" href="#__codelineno-25-55"></a>iface br1-patch0 inet manual
</span><span id="__span-25-56"><a id="__codelineno-25-56" name="__codelineno-25-56" href="#__codelineno-25-56"></a>ovs_bridge br1
</span><span id="__span-25-57"><a id="__codelineno-25-57" name="__codelineno-25-57" href="#__codelineno-25-57"></a>ovs_type OVSPatchPort
</span><span id="__span-25-58"><a id="__codelineno-25-58" name="__codelineno-25-58" href="#__codelineno-25-58"></a>ovs_patch\_peer br0-patch0
</span><span id="__span-25-59"><a id="__codelineno-25-59" name="__codelineno-25-59" href="#__codelineno-25-59"></a>
</span><span id="__span-25-60"><a id="__codelineno-25-60" name="__codelineno-25-60" href="#__codelineno-25-60"></a>allow-br1 br1-patch1
</span><span id="__span-25-61"><a id="__codelineno-25-61" name="__codelineno-25-61" href="#__codelineno-25-61"></a>iface br1-patch1 inet manual
</span><span id="__span-25-62"><a id="__codelineno-25-62" name="__codelineno-25-62" href="#__codelineno-25-62"></a>ovs_bridge br1
</span><span id="__span-25-63"><a id="__codelineno-25-63" name="__codelineno-25-63" href="#__codelineno-25-63"></a>ovs_type OVSPatchPort
</span><span id="__span-25-64"><a id="__codelineno-25-64" name="__codelineno-25-64" href="#__codelineno-25-64"></a>ovs_patch\_peer br2-patch0
</span><span id="__span-25-65"><a id="__codelineno-25-65" name="__codelineno-25-65" href="#__codelineno-25-65"></a>
</span><span id="__span-25-66"><a id="__codelineno-25-66" name="__codelineno-25-66" href="#__codelineno-25-66"></a><span class="gh"># Configuration du bridge br2</span>
</span><span id="__span-25-67"><a id="__codelineno-25-67" name="__codelineno-25-67" href="#__codelineno-25-67"></a>auto br2
</span><span id="__span-25-68"><a id="__codelineno-25-68" name="__codelineno-25-68" href="#__codelineno-25-68"></a>allow-ovs br2
</span><span id="__span-25-69"><a id="__codelineno-25-69" name="__codelineno-25-69" href="#__codelineno-25-69"></a>iface br2 inet manual
</span><span id="__span-25-70"><a id="__codelineno-25-70" name="__codelineno-25-70" href="#__codelineno-25-70"></a>ovs_type OVSBridge
</span><span id="__span-25-71"><a id="__codelineno-25-71" name="__codelineno-25-71" href="#__codelineno-25-71"></a>ovs_ports enp0s9 br2-patch0
</span><span id="__span-25-72"><a id="__codelineno-25-72" name="__codelineno-25-72" href="#__codelineno-25-72"></a> &nbsp;
</span><span id="__span-25-73"><a id="__codelineno-25-73" name="__codelineno-25-73" href="#__codelineno-25-73"></a>allow-br2 enp0s9
</span><span id="__span-25-74"><a id="__codelineno-25-74" name="__codelineno-25-74" href="#__codelineno-25-74"></a>iface enp0s9 inet manual
</span><span id="__span-25-75"><a id="__codelineno-25-75" name="__codelineno-25-75" href="#__codelineno-25-75"></a>ovs_bridge br2
</span><span id="__span-25-76"><a id="__codelineno-25-76" name="__codelineno-25-76" href="#__codelineno-25-76"></a>ovs_type OVSPort
</span><span id="__span-25-77"><a id="__codelineno-25-77" name="__codelineno-25-77" href="#__codelineno-25-77"></a>
</span><span id="__span-25-78"><a id="__codelineno-25-78" name="__codelineno-25-78" href="#__codelineno-25-78"></a> # Liaison patch br2 vers br1&nbsp;
</span><span id="__span-25-79"><a id="__codelineno-25-79" name="__codelineno-25-79" href="#__codelineno-25-79"></a>allow-br2 br2-patch0
</span><span id="__span-25-80"><a id="__codelineno-25-80" name="__codelineno-25-80" href="#__codelineno-25-80"></a>iface br2-patch0 inet manual
</span><span id="__span-25-81"><a id="__codelineno-25-81" name="__codelineno-25-81" href="#__codelineno-25-81"></a>ovs_bridge br2
</span><span id="__span-25-82"><a id="__codelineno-25-82" name="__codelineno-25-82" href="#__codelineno-25-82"></a>ovs_type OVSPatchPort
</span><span id="__span-25-83"><a id="__codelineno-25-83" name="__codelineno-25-83" href="#__codelineno-25-83"></a>ovs_patch\_peer br1-patch1
</span></code></pre></div>
<p>Redémarrez la VM pour appliquer la configuration :</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="o">[</span>switch@ovs:~$<span class="o">]</span><span class="w"> </span>sudo<span class="w"> </span>reboot
</span></code></pre></div>
<p>puis contrôlez le statut du service réseau :</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="o">[</span>switch@ovs:~$<span class="o">]</span><span class="w"> </span>sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>networking
</span></code></pre></div>
<p>ainsi que le contenu de la Bdd d'Open vSwitch :</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="o">[</span>switch@ovs:~$<span class="o">]</span><span class="w"> </span>sudo<span class="w"> </span>ovs-vsctl<span class="w"> </span>show
</span></code></pre></div>
<h4 id="-parametrage-reseau-vbox"><em>- Paramétrage réseau VBox</em></h4>
<p>Sans stopper les VM, modifiez l'onglet réseau des 2 clients debian12-vm* comme suit :<br>
-&gt; Adapter 1<br>
-&gt; Mode d'accès réseau &gt; Réseau interne<br>
-&gt; Name &gt; Sélectionnez liaison_vm* selon la VM<br>
-&gt; OK</p>
<h3 id="raccordement-vm1-2-sur-br0">Raccordement vm1-2 sur br0</h3>
<p>Vous avez découvert ci-dessus le raccordement sur plusieurs bridges reliés entre eux par des ports patch.</p>
<p>Il est possible aussi de faire plus simple en raccordant toutes les interfaces réseau de la VM ovs sur un seul bridge tel br0.</p>
<p>Exemple :</p>
<figure>
<p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="../images/2025/08/ovs-bridge-simple.webp" data-title="Image - Open vSwitch : Version un seul bridge" data-desc-position="bottom"><img alt="Image - Open vSwitch : Version un seul bridge" src="../images/2025/08/ovs-bridge-simple.webp"></a>
  </p>
<figcaption>Open vSwitch : Version un seul bridge</figcaption>
</figure>
<p>Au préalable, supprimez les bridges br1 et br2 construits dans la partie 4 comme ceci :</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="o">[</span>switch@ovs:~$<span class="o">]</span><span class="w"> </span>sudo<span class="w"> </span>ovs-vsctl<span class="w"> </span>del-br<span class="w"> </span>br1
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="o">[</span>switch@ovs:~$<span class="o">]</span><span class="w"> </span>sudo<span class="w"> </span>ovs-vsctl<span class="w"> </span>del-br<span class="w"> </span>br2
</span></code></pre></div>
<p>Editez ensuite le fichier réseau interfaces :</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="o">[</span>switch@ovs:~$<span class="o">]</span><span class="w"> </span>sudo<span class="w"> </span>nano<span class="w"> </span>/etc/network/interfaces
</span></code></pre></div>
<p>et modifiez son contenu comme suit :</p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="gh"># This file describes the network interfaces availabl...</span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="gh"># and how to activate them. For more information, see ...</span>
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a>
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a>source /etc/network/interfaces.d/*
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a>
</span><span id="__span-31-6"><a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a><span class="gh"># The loopback network interface</span>
</span><span id="__span-31-7"><a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a>auto lo
</span><span id="__span-31-8"><a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a>iface lo inet loopback
</span><span id="__span-31-9"><a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a>
</span><span id="__span-31-10"><a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a><span class="gu">## Configuration Open vSwitch</span>
</span><span id="__span-31-11"><a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a><span class="gh"># Activation de l'interface br0</span>
</span><span id="__span-31-12"><a id="__codelineno-31-12" name="__codelineno-31-12" href="#__codelineno-31-12"></a>auto br0
</span><span id="__span-31-13"><a id="__codelineno-31-13" name="__codelineno-31-13" href="#__codelineno-31-13"></a>allow-ovs br0
</span><span id="__span-31-14"><a id="__codelineno-31-14" name="__codelineno-31-14" href="#__codelineno-31-14"></a>
</span><span id="__span-31-15"><a id="__codelineno-31-15" name="__codelineno-31-15" href="#__codelineno-31-15"></a><span class="gh"># Configuration IP de l'interface br0</span>
</span><span id="__span-31-16"><a id="__codelineno-31-16" name="__codelineno-31-16" href="#__codelineno-31-16"></a>iface br0 inet static
</span><span id="__span-31-17"><a id="__codelineno-31-17" name="__codelineno-31-17" href="#__codelineno-31-17"></a>address 192.168.3.15
</span><span id="__span-31-18"><a id="__codelineno-31-18" name="__codelineno-31-18" href="#__codelineno-31-18"></a>netmask 255.255.255.0
</span><span id="__span-31-19"><a id="__codelineno-31-19" name="__codelineno-31-19" href="#__codelineno-31-19"></a>gateway 192.168.3.1
</span><span id="__span-31-20"><a id="__codelineno-31-20" name="__codelineno-31-20" href="#__codelineno-31-20"></a>ovs_type OVSBridge
</span><span id="__span-31-21"><a id="__codelineno-31-21" name="__codelineno-31-21" href="#__codelineno-31-21"></a>ovs_ports enp0s3 enp0s8 enp0s9
</span><span id="__span-31-22"><a id="__codelineno-31-22" name="__codelineno-31-22" href="#__codelineno-31-22"></a>
</span><span id="__span-31-23"><a id="__codelineno-31-23" name="__codelineno-31-23" href="#__codelineno-31-23"></a><span class="gh"># Attachement du port/interface enp0s3 au bridge br0</span>
</span><span id="__span-31-24"><a id="__codelineno-31-24" name="__codelineno-31-24" href="#__codelineno-31-24"></a>allow-br0 enp0s3
</span><span id="__span-31-25"><a id="__codelineno-31-25" name="__codelineno-31-25" href="#__codelineno-31-25"></a>iface enp0s3 inet manual
</span><span id="__span-31-26"><a id="__codelineno-31-26" name="__codelineno-31-26" href="#__codelineno-31-26"></a>ovs_bridge br0
</span><span id="__span-31-27"><a id="__codelineno-31-27" name="__codelineno-31-27" href="#__codelineno-31-27"></a>ovs_type OVSPort
</span><span id="__span-31-28"><a id="__codelineno-31-28" name="__codelineno-31-28" href="#__codelineno-31-28"></a>
</span><span id="__span-31-29"><a id="__codelineno-31-29" name="__codelineno-31-29" href="#__codelineno-31-29"></a><span class="gh"># Attachement du port/interface enp0s8 au bridge br0</span>
</span><span id="__span-31-30"><a id="__codelineno-31-30" name="__codelineno-31-30" href="#__codelineno-31-30"></a>allow-br0 enp0s8
</span><span id="__span-31-31"><a id="__codelineno-31-31" name="__codelineno-31-31" href="#__codelineno-31-31"></a>iface enp0s8 inet manual
</span><span id="__span-31-32"><a id="__codelineno-31-32" name="__codelineno-31-32" href="#__codelineno-31-32"></a>ovs_bridge br0
</span><span id="__span-31-33"><a id="__codelineno-31-33" name="__codelineno-31-33" href="#__codelineno-31-33"></a>ovs_type OVSPort
</span><span id="__span-31-34"><a id="__codelineno-31-34" name="__codelineno-31-34" href="#__codelineno-31-34"></a>
</span><span id="__span-31-35"><a id="__codelineno-31-35" name="__codelineno-31-35" href="#__codelineno-31-35"></a><span class="gh"># Attachement du port/interface enp0s9 au bridge br0</span>
</span><span id="__span-31-36"><a id="__codelineno-31-36" name="__codelineno-31-36" href="#__codelineno-31-36"></a>allow-br0 enp0s9
</span><span id="__span-31-37"><a id="__codelineno-31-37" name="__codelineno-31-37" href="#__codelineno-31-37"></a>iface enp0s9 inet manual
</span><span id="__span-31-38"><a id="__codelineno-31-38" name="__codelineno-31-38" href="#__codelineno-31-38"></a>ovs_bridge br0
</span><span id="__span-31-39"><a id="__codelineno-31-39" name="__codelineno-31-39" href="#__codelineno-31-39"></a>ovs_type OVSPort
</span></code></pre></div>
<p>Redémarrez la VM pour appliquer la configuration :</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="o">[</span>switch@ovs:~$<span class="o">]</span><span class="w"> </span>sudo<span class="w"> </span>reboot
</span></code></pre></div>
<p>Vérifiez enfin le résultat de celle-ci :</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="o">[</span>switch@ovs:~$<span class="o">]</span><span class="w"> </span>sudo<span class="w"> </span>ovs-vsctl<span class="w"> </span>show
</span></code></pre></div>
<p>Retour normal :</p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a>Bridge br0
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a>    Port enp0s9
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a>        Interface enp0s9
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a>    Port enp0s8
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a>        Interface enp0s8
</span><span id="__span-34-6"><a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a>    Port enp0s3
</span><span id="__span-34-7"><a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a>        Interface enp0s3
</span><span id="__span-34-8"><a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a>    Port br0
</span><span id="__span-34-9"><a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a>        Interface br0
</span><span id="__span-34-10"><a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a>            type: internal
</span><span id="__span-34-11"><a id="__codelineno-34-11" name="__codelineno-34-11" href="#__codelineno-34-11"></a>ovs_version: "3.1.0"
</span></code></pre></div>
<h3 id="test-du-fonctionnement-dovs">Test du fonctionnement d'OvS</h3>
<p>Vérifiez à l'aide de la Cde ping la conformité des résultats avec ceux indiqués sur la <a href="../images/2018/05/maquette-base-ipfire.png" target="_blank">maquette</a> réseau local virtuel.</p>
<p>Stoppez ensuite la VM ovs support d'Open vSwitch et assurez-vous que les 2 clients Debian ne peuvent plus communiquer entre eux.</p>
<p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="../images/2023/07/redacteur_satisfait.jpg" data-title="Image - Rédacteur satisfait" data-desc-position="bottom"><img align="left" alt="Image - Rédacteur satisfait" src="../images/2023/07/redacteur_satisfait.jpg" title="Image Pixabay - Mohamed Hassan"></a></p>
<p>&nbsp;<br>
Voilà, c'est terminé !<br>
Le réseau virtuel de base est créé.<br>
Le mémento 5.2 vous attend pour<br>
découvrir les conteneurs.</p>
<p><a class="md-button md-button--primary" href="../podman---vboxdeb12-12/">Mémento 5.2</a></p>







  
  




  



      
    </article>
  </div>

          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Retour en haut de la page
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
        
      
      <nav class="md-footer__inner md-grid" aria-label="Pied de page">
        
          
          <a href="../podman---vboxdeb12-12/" class="md-footer__link md-footer__link--prev" aria-label="Précédent: Podman - VBox/Deb12 1/2">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Précédent
              </span>
              <div class="md-ellipsis">
                Podman - VBox/Deb12 1/2
              </div>
            </div>
          </a>
        
        
          
          <a href="../ssh--cl%C3%A9s-publique-et-priv%C3%A9e/" class="md-footer__link md-footer__link--next" aria-label="Suivant: SSH – Clés publique et privée">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Suivant
              </span>
              <div class="md-ellipsis">
                SSH – Clés publique et privée
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"></path></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright © 2024 - Leloup Gérard
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.tabs", "navigation.sections", "navigation.top", "navigation.footer", "content.code.copy"], "search": "../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copi\u00e9 dans le presse-papier", "clipboard.copy": "Copier dans le presse-papier", "search.result.more.one": "1 de plus sur cette page", "search.result.more.other": "# de plus sur cette page", "search.result.none": "Aucun document trouv\u00e9", "search.result.one": "1 document trouv\u00e9", "search.result.other": "# documents trouv\u00e9s", "search.result.placeholder": "Taper pour d\u00e9marrer la recherche", "search.result.term.missing": "Non trouv\u00e9", "select.version": "S\u00e9lectionner la version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
    
  
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": false, "loop": false, "zoomable": true, "draggable": false, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "none"});
document$.subscribe(()=>{ lightbox.reload(); });
</script></body></html>